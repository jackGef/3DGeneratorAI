services:
  # MongoDB Database (using external MongoDB Atlas free tier)
  # Note: Render doesn't offer free MongoDB, use MongoDB Atlas instead
  # Connection string will be set via environment variable

  # Model Server deployed separately on Hugging Face Spaces
  # See model-server/README.md for deployment instructions
  # Free tier with 16GB RAM - better for AI workloads

  # Backend API Service
  - type: web
    name: 3dgenerator-backend
    runtime: docker
    dockerfilePath: ./backend/Dockerfile
    dockerContext: ./backend
    plan: free
    region: oregon
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 8081
      - key: MONGODB_URI
        sync: false  # Set this in Render dashboard (MongoDB Atlas connection string)
      - key: MODEL_SERVER_URL
        sync: false  # Set this to your HF Space URL: https://YOUR_USERNAME-3dgenerator-model-server.hf.space
      - key: ASSETS_DIR
        value: /data/assets
      - key: PUBLIC_BASE_URL
        fromService:
          type: web
          name: 3dgenerator-backend
          property: host
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_REFRESH_SECRET
        generateValue: true
      - key: JWT_EXPIRES_IN
        value: 15m
      - key: JWT_REFRESH_EXPIRES_IN
        value: 30d
      - key: EMAIL_HOST
        value: smtp.gmail.com
      - key: EMAIL_PORT
        value: 587
      - key: EMAIL_USER
        sync: false  # Set in Render dashboard
      - key: EMAIL_PASS
        sync: false  # Set in Render dashboard
      - key: EMAIL_FROM
        sync: false  # Set in Render dashboard
      - key: ALLOWED_ORIGINS
        fromService:
          type: web
          name: 3dgenerator-frontend
          property: host
      - key: NODE_ENV
        value: production

  # Frontend Static Site
  - type: web
    name: 3dgenerator-frontend
    runtime: docker
    dockerfilePath: ./front/Dockerfile
    dockerContext: ./front
    plan: free
    region: oregon
    envVars:
      - key: VITE_API_BASE
        fromService:
          type: web
          name: 3dgenerator-backend
          property: host
